<!DOCTYPE html>
<head>
    <title>Create Post</title>
     <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-10">

            <div class="card shadow-sm border-0">
                <div class="card-header bg-dark text-white">
                    <h4 class="mb-0">Create New Post</h4>
                </div>

                <div class="card-body">

                    <form id="createPostForm">

                        <!-- Title -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Post Title</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="title" 
                                   placeholder="Enter post title">
                            <small class="text-danger" id="title_error"></small>
                        </div>

                        <!-- Content -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold">Post Content</label>
                            <textarea class="form-control" 
                                      id="content" 
                                      rows="6" 
                                      placeholder="Write your post content here..."></textarea>
                            <small class="text-danger" id="content_error"></small>
                        </div>

                        <!-- Buttons -->
                        <div class="d-flex justify-content-between">
                            <a href="dashboard.html" class="btn btn-secondary">
                                Cancel
                            </a>

                            <button type="submit" class="btn btn-primary">
                                Publish Post
                            </button>
                        </div>

                    </form>

                    <!-- Success Message -->
                    <div class="alert alert-success mt-3 d-none" id="successMessage"></div>

                </div>
            </div>

        </div>
    </div>
</div>

<script src="../js/jquery-4.0.0.min.js"></script>

<script>
    $(document).ready(function () {
        $('#createPostForm').submit( function (e){
            e.preventDefault();

            let user = JSON.parse(localStorage.getItem("user"));

            $.ajax({
                url: "http://127.0.0.1:8000/api/create-post",
                type: "POST",
                contentType: "application/json",
                dataType:"json",
                data:JSON.stringify({
                    title: $("#title").val(),
                    content:$("#content").val(),
                    user_id: user.id
                }),

                success: function(data){
                    $("#successMessage").removeClass('d-none');
                    $("#successMessage").text(data.message);
                    
                },
                error: function(error){
                    if(error.status == 422){
                        let errors  = error.responseJSON.errors;

                        if(error.title){
                            $("#title_error").text(errors.title[0])
                        }

                        if(error.content){
                            $("#content_error").text(errors.content[0])
                        }
                    }
                }
            })

        })


    })


</script>

</body>
</html>